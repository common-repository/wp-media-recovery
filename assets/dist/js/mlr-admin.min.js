var MLR=MLR||{};MLR.ajaxUrl=mlr.ajax_url,MLR.pluginUrl=mlr.plugin_url,MLR.pluginDomain=mlr.plugin_domain,MLR.ajaxNonce=mlr.ajax_nonce,MLR.recoverMedia=function(e){e.preventDefault();var i=jQuery(e.target),r=i.closest(".mlr-admin"),a=new Array,t=0;if(jQuery.each(jQuery(".mlr-media-thumbnail"),function(){var e=jQuery(this).find('input[name="image_files[]"]');e.is(":checked")&&e.val()&&(a[t++]=e.val())}),0===a.length)return window.alert("You MUST select at least 1 image for recovery."),!1;jQuery.ajax({type:"post",url:MLR.ajaxUrl,data:{_wpnonce:MLR.ajaxNonce,action:"mlr_recover_media",image_files:JSON.stringify(a)},beforeSend:function(){i.prop("disabled",!0).text("Recovery in progress..."),i.next().empty().addClass("mlr-in-progress")},success:function(e){void 0!==e.success&&!1===e.success||(1===(e=JSON.parse(e)[0]).status?(i.prop("disabled",!1).text("Media Recovery..."),i.next().removeClass("mlr-in-progress"),r.find("span").empty().html(e.message),jQuery(".mlr-explorer-grid").hide().load(window.location.href+" .mlr-explorer-grid > *","").fadeIn(),setTimeout(function(){jQuery('input[name="mlr-hide-existing-media"]').is(":checked")&&MLR.hideExistingMedia()},1e3)):window.alert(e.message))},complete:function(){},error:function(){window.alert("Internal Server Error! Contact your hosting provider and access your logs to learn more about what is causing the error.")}})},MLR.hideExistingMedia=function(e){var i=jQuery(".mlr-hide-media label"),r=jQuery('input[name="mlr-hide-existing-media"]'),a=0;void 0!==e&&(r.is(":checked")?localStorage.setItem("mlr-existing-media",1):localStorage.removeItem("mlr-existing-media")),localStorage.getItem("mlr-existing-media")&&r.prop("checked",!0),jQuery.each(jQuery(".mlr-media-thumbnail"),function(){jQuery(this).find(".dashicons").hasClass("dashicons-visibility")&&(jQuery(this).toggle(),a++)}),i.find("strong").remove(),0<a&&(e=jQuery("<strong/>").html(` &mdash; You have ${a} hidden item(s) on this page.`),r.is(":checked"))&&i.append(e)},MLR.limitUsage=function(e){e.preventDefault();var e=jQuery(e.target),i=jQuery(".mlr-explorer-grid img.selected").length,r=jQuery(".mlr-explorer-pagination .button-action span");if(!jQuery(this).hasClass("in-library")&&!jQuery(this).hasClass("oversize-limit"))if(e.find('input[type="checkbox"]').is(":checked"))e.find("img").toggleClass("selected"),e.find('input[type="checkbox"]').prop("checked",!1),e.find(".dashicons").removeClass("dashicons-yes").addClass("dashicons-hidden");else{if(9<i)return window.alert("You CANNOT recover more than 10 images at a time."),!1;e.find("img").toggleClass("selected"),e.find('input[type="checkbox"]').prop("checked",!0),e.find(".dashicons").addClass("dashicons-yes").removeClass("dashicons-hidden")}i=jQuery(".mlr-explorer-grid img.selected").length,r.empty().text(`You have selected ${i}/10 for recovery.`)},function(e){setTimeout(()=>jQuery(".mlr-explorer-grid").css("display","flex"),1e3),localStorage.getItem("mlr-existing-media")&&MLR.hideExistingMedia(),e(document).on("click",'button[name="mlr-media-recovery-button"]',MLR.recoverMedia),e(document).on("click",'input[name="mlr-hide-existing-media"]',MLR.hideExistingMedia),e(document).on("click",".mlr-media-thumbnail",MLR.limitUsage)}(jQuery);